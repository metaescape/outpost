<!DOCTYPE html>
<html>
  <head>
    <title>Site Traffic</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <style>
      body {
        font-family: "Arial", sans-serif;
        margin: 20px;
        color: #333;
      }

      #total {
        background-color: #f0f0f0; /* 浅灰色背景 */
        color: #333; /* 文字颜色 */
        padding: 10px 20px; /* 内边距 */
        border-radius: 8px; /* 边角圆滑 */
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1); /* 简单的阴影效果 */
        display: inline-block; /* 使它不占据整行 */
        font-size: 16px; /* 字体大小 */
        display: flex;
        justify-content: center;
      }
    </style>
  </head>

  <body>
    <p id="total"></p>

    <div style="max-height: 40vh">
      <canvas id="myChart"></canvas>
    </div>

    <script>
      fetch("traffic.jsonl")
        .then((response) => response.text())
        .then((data) => {
          const trafficData = data
            .split("\n")
            .filter((line) => line.trim() !== "");

          const dates = [];
          const visits = [];
          const uniques = [];

          trafficData.forEach((line) => {
            const [date, visit, unique] = JSON.parse(line);
            dates.push(date);
            visits.push(visit);
            uniques.push(unique);
          });
          const totalVisits = visits.reduce((sum, visit) => sum + visit, 0);
          const totalUniques = uniques.reduce((sum, unique) => sum + unique, 0);

          const totalInfo = `Total: ${totalVisits}, Total Uniques: ${totalUniques} from ${
            dates[0]
          } to ${dates[dates.length - 1]}`;
          document.getElementById("total").innerText = totalInfo;

          const ctx = document.getElementById("myChart").getContext("2d");

          new Chart(ctx, {
            type: "line",
            data: {
              labels: dates,
              datasets: [
                {
                  label: "ips",
                  data: visits,

                  fill: false,
                },
                {
                  label: "uips",
                  data: uniques,

                  fill: false,
                },
              ],
            },

            options: {
              responsive: true,
              maintainAspectRatio: false,
              scales: {
                x: {
                  ticks: {
                    display: false, // Hide x-labels on x-ticks
                  },
                },
              },
            },
          });
        })
        .catch((error) => {
          console.error("Error:", error);
        });
    </script>
  </body>
</html>
